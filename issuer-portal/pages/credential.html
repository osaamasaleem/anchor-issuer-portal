<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credential Details - Anchor Issuer Portal</title>
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/pages.css">
    <link rel="stylesheet" href="../css/utilities.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation - Loaded dynamically -->
    <div id="navbar"></div>
    
    <!-- Sidebar - Loaded dynamically -->
    <div id="sidebar"></div>
    
    <!-- Main Content -->
    <main class="main-content">
        <div class="credential-header">
            <div class="credential-info">
                <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                    <a href="registry.html" class="btn btn-sm btn-outline">
                        <i class="fas fa-arrow-left" style="margin-right: 6px;"></i>
                        Back to Registry
                    </a>
                    <span id="credentialStatus" class="badge badge-success">Valid</span>
                </div>
                <h1 id="studentName">Usama Saleem</h1>
                <p id="degreeTitle" style="color: #311F5A; font-weight: 500; font-size: 18px;">
                    BS Computer Science
                </p>
            </div>
            
            <div class="credential-actions">
                <button onclick="viewOnBlockchain()" class="btn btn-outline">
                    <i class="fas fa-external-link-alt" style="margin-right: 8px;"></i>
                    View on Chain
                </button>
                <button onclick="revokeCredential()" class="btn btn-danger">
                    <i class="fas fa-ban" style="margin-right: 8px;"></i>
                    Revoke
                </button>
            </div>
        </div>
        
        <!-- Credential Sections -->
        <div class="credential-sections">
            <!-- Student Information -->
            <div class="info-card">
                <h3>
                    <i class="fas fa-user-graduate" style="margin-right: 12px;"></i>
                    Student Information
                </h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Full Name</span>
                        <span class="info-value" id="studentFullName">Usama Saleem</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Student ID</span>
                        <span class="info-value" id="studentID">F12345678</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Student DID</span>
                        <span class="info-value" style="font-family: monospace; font-size: 12px;" 
                              id="studentDID">did:ethr:0x123abc...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Email</span>
                        <span class="info-value" id="studentEmail">usama@student.edu</span>
                    </div>
                </div>
            </div>
            
            <!-- Academic Details -->
            <div class="info-card">
                <h3>
                    <i class="fas fa-graduation-cap" style="margin-right: 12px;"></i>
                    Academic Details
                </h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Degree</span>
                        <span class="info-value" id="degree">BS Computer Science</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Major</span>
                        <span class="info-value" id="major">Artificial Intelligence</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">GPA</span>
                        <span class="info-value" id="gpa">3.8</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Honors</span>
                        <span class="info-value" id="honors">Summa Cum Laude</span>
                    </div>
                </div>
            </div>
            
            <!-- Issuance Details -->
            <div class="info-card">
                <h3>
                    <i class="fas fa-calendar-alt" style="margin-right: 12px;"></i>
                    Dates & Timeline
                </h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Graduation Date</span>
                        <span class="info-value" id="graduationDate">Jan 15, 2024</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Issuance Date</span>
                        <span class="info-value" id="issuanceDate">Jan 16, 2024</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Expiration</span>
                        <span class="info-value" id="expirationDate">Permanent</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Last Updated</span>
                        <span class="info-value" id="lastUpdated">Just now</span>
                    </div>
                </div>
            </div>
            
            <!-- Technical Information -->
            <div class="info-card">
                <h3>
                    <i class="fas fa-code" style="margin-right: 12px;"></i>
                    Technical Information
                </h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Transaction Hash</span>
                        <span class="info-value" style="font-family: monospace; font-size: 12px;" 
                              id="txHash">0xabc123def456...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">IPFS Hash</span>
                        <span class="info-value" style="font-family: monospace; font-size: 12px;" 
                              id="ipfsHash">QmXYZ123ABC456...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Issuer DID</span>
                        <span class="info-value" style="font-family: monospace; font-size: 12px;" 
                              id="issuerDID">did:ethr:0x789ghi...</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Credential ID</span>
                        <span class="info-value" style="font-family: monospace; font-size: 12px;" 
                              id="credentialID">cred:123456</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Status Timeline -->
        <div class="card mt-5">
            <div class="card-header">
                <h3>Status Timeline</h3>
            </div>
            <div class="card-body">
                <div style="display: flex; flex-direction: column; gap: 24px; position: relative; 
                            padding-left: 30px;">
                    <!-- Timeline line -->
                    <div style="position: absolute; left: 15px; top: 0; bottom: 0; 
                                width: 2px; background: #E2E8F0;"></div>
                    
                    <!-- Timeline items -->
                    <div class="timeline-item">
                        <div style="position: absolute; left: -25px; width: 32px; height: 32px; 
                                    background: #311F5A; border-radius: 50%; display: flex; 
                                    align-items: center; justify-content: center; color: white;">
                            <i class="fas fa-file-signature"></i>
                        </div>
                        <div>
                            <h4 style="color: #1A202C; margin-bottom: 4px;">Credential Issued</h4>
                            <p style="color: #718096; font-size: 14px;">Signed and stored on blockchain</p>
                            <p style="color: #A0AEC0; font-size: 12px;">Jan 16, 2024 10:30 AM</p>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div style="position: absolute; left: -25px; width: 32px; height: 32px; 
                                    background: #4A3A75; border-radius: 50%; display: flex; 
                                    align-items: center; justify-content: center; color: white;">
                            <i class="fas fa-qrcode"></i>
                        </div>
                        <div>
                            <h4 style="color: #1A202C; margin-bottom: 4px;">QR Code Generated</h4>
                            <p style="color: #718096; font-size: 14px;">Shared with student for claiming</p>
                            <p style="color: #A0AEC0; font-size: 12px;">Jan 16, 2024 10:32 AM</p>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div style="position: absolute; left: -25px; width: 32px; height: 32px; 
                                    background: #C6F6D5; border-radius: 50%; display: flex; 
                                    align-items: center; justify-content: center; color: #22543D;">
                            <i class="fas fa-check"></i>
                        </div>
                        <div>
                            <h4 style="color: #1A202C; margin-bottom: 4px;">Active</h4>
                            <p style="color: #718096; font-size: 14px;">Credential is currently valid</p>
                            <p style="color: #A0AEC0; font-size: 12px;">Now</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Danger Zone -->
        <div class="card mt-5" style="border-color: #FED7D7;">
            <div class="card-header" style="background: #FFF5F5; border-color: #FED7D7;">
                <h3 style="color: #822727;">
                    <i class="fas fa-exclamation-triangle" style="margin-right: 12px;"></i>
                    Danger Zone
                </h3>
            </div>
            <div class="card-body">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h4 style="color: #1A202C; margin-bottom: 8px;">Revoke Credential</h4>
                        <p style="color: #718096; font-size: 14px;">
                            This will mark the credential as invalid on the blockchain. 
                            This action cannot be undone.
                        </p>
                    </div>
                    <button onclick="window.location.href='revocation.html?id=' + getCredentialId()" 
                            class="btn btn-danger btn-lg">
                        <i class="fas fa-ban" style="margin-right: 8px;"></i>
                        Revoke Credential
                    </button>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Scripts -->
    <script src="../js/utils.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            // Load components
            await Utils.loadComponent('navbar', '../components/navbar.html');
            await Utils.loadComponent('sidebar', '../components/sidebar.html');
            
            // Check authentication
            if (!Auth.requireAuth()) return;
            
            const user = Auth.getCurrentUser();
            Utils.updateUserInfo(user);
            Utils.initSidebarActiveState();
            
            // Load credential data
            loadCredentialData();
        });
        
        // Mock credential data
        const mockCredentialData = {
            id: 'cred-123',
            studentName: 'Usama Saleem',
            studentDID: 'did:ethr:0x123abc456def789ghi',
            studentID: 'F12345678',
            studentEmail: 'usama@student.edu',
            degree: 'BS Computer Science',
            major: 'Artificial Intelligence',
            gpa: '3.8',
            honors: 'Summa Cum Laude',
            graduationDate: '2024-01-15',
            issuanceDate: '2024-01-16',
            expirationDate: null,
            txHash: '0xabc123def456ghi789jkl012mno345pqr678',
            ipfsHash: 'QmXYZ123ABC456DEF789GHI012JKL345MNO678',
            issuerDID: 'did:ethr:0x789ghi012jkl345mno678pqr901stu234',
            status: 'Valid',
            lastUpdated: new Date().toISOString()
        };
        
        function loadCredentialData() {
            // Get credential ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const credentialId = urlParams.get('id');
            
            // In a real app, fetch data from API
            // For demo, use mock data
            const credential = mockCredentialData;
            
            // Update UI with credential data
            document.getElementById('studentName').textContent = credential.studentName;
            document.getElementById('studentFullName').textContent = credential.studentName;
            document.getElementById('studentID').textContent = credential.studentID;
            document.getElementById('studentDID').textContent = credential.studentDID.substring(0, 20) + '...';
            document.getElementById('studentEmail').textContent = credential.studentEmail;
            
            document.getElementById('degreeTitle').textContent = credential.degree;
            document.getElementById('degree').textContent = credential.degree;
            document.getElementById('major').textContent = credential.major || 'N/A';
            document.getElementById('gpa').textContent = credential.gpa;
            document.getElementById('honors').textContent = credential.honors || 'N/A';
            
            document.getElementById('graduationDate').textContent = Utils.formatDate(credential.graduationDate);
            document.getElementById('issuanceDate').textContent = Utils.formatDate(credential.issuanceDate);
            document.getElementById('expirationDate').textContent = credential.expirationDate 
                ? Utils.formatDate(credential.expirationDate) 
                : 'Permanent';
            document.getElementById('lastUpdated').textContent = 'Just now';
            
            document.getElementById('txHash').textContent = credential.txHash.substring(0, 20) + '...';
            document.getElementById('ipfsHash').textContent = credential.ipfsHash.substring(0, 20) + '...';
            document.getElementById('issuerDID').textContent = credential.issuerDID.substring(0, 20) + '...';
            document.getElementById('credentialID').textContent = credential.id;
            
            // Update status badge
            const statusElement = document.getElementById('credentialStatus');
            statusElement.textContent = credential.status;
            statusElement.className = `badge ${credential.status === 'Valid' ? 'badge-success' : 
                                     credential.status === 'Pending' ? 'badge-warning' : 'badge-danger'}`;
        }
        
        function getCredentialId() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id') || 'cred-123';
        }
        
        function viewOnBlockchain() {
            const credential = mockCredentialData;
            window.open(`https://polygonscan.com/tx/${credential.txHash}`, '_blank');
        }
        
        function revokeCredential() {
            window.location.href = `revocation.html?id=${getCredentialId()}`;
        }
        
    </script>
    
    <style>
        .timeline-item {
            position: relative;
            padding-bottom: 8px;
        }
        
        .timeline-item:last-child {
            padding-bottom: 0;
        }
        
        .timeline-item > div:last-child {
            margin-left: 24px;
        }
    </style>
</body>
</html>